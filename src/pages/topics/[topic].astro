---
import Layout from '../../layouts/Layout.astro';
import ResourceLibrary from '../../components/ResourceLibrary.astro';
import AdditionalResources from '../../components/AdditionalResources.astro';
import SearchAndFilter from '../../components/SearchAndFilter';
import LearningRoadmap from '../../components/LearningRoadmap';

// TOPIC ROADMAP
export function getStaticPaths() {
  const topicRoadmaps = {
    quran: {
      nodes: [
        {
          id: 'quran-basic',
          label: 'Dasar Al-Quran',
          description: 'Belajar membaca Al-Quran dan tajwid dasar',
          level: 'basic',
          position: { x: 50, y: 250 },
          resources: [
            {
              title: 'Pengenalan Huruf Hijaiyah',
              type: 'video',
              description: 'Video pembelajaran mengenal huruf hijaiyah dan cara membacanya',
              url: 'https://www.youtube.com/watch?v=UpYx7F14oxo',
              subResources: [
                {
                  title: 'Bentuk Huruf Hijaiyah',
                  type: 'article',
                  description: 'Penjelasan detail tentang bentuk-bentuk huruf hijaiyah',
                  url: 'https://example.com/hijaiyah-forms'
                },
                {
                  title: 'Latihan Pengucapan',
                  type: 'video',
                  description: 'Praktik pengucapan huruf hijaiyah dengan benar',
                  url: 'https://example.com/hijaiyah-pronunciation'
                },
                {
                  title: 'Menulis Huruf Hijaiyah',
                  type: 'video',
                  description: 'Tutorial cara menulis huruf hijaiyah dengan benar',
                  url: 'https://example.com/hijaiyah-writing'
                }
              ]
            },
            {
              title: 'Dasar-dasar Ilmu Tajwid',
              type: 'book',
              description: 'Buku panduan lengkap belajar tajwid untuk pemula',
              url: 'https://example.com/tajwid-book',
              subResources: [
                {
                  title: 'Hukum Nun Sukun dan Tanwin',
                  type: 'video',
                  description: 'Penjelasan tentang hukum nun sukun dan tanwin',
                  url: 'https://example.com/nun-sukun'
                },
                {
                  title: 'Hukum Mim Sukun',
                  type: 'article',
                  description: 'Pembahasan tentang hukum mim sukun',
                  url: 'https://example.com/mim-sukun'
                },
                {
                  title: 'Mad (Panjang Pendek)',
                  type: 'video',
                  description: 'Penjelasan tentang hukum mad dalam Al-Quran',
                  url: 'https://example.com/mad-rules'
                }
              ]
            }
          ]
        },
        {
          id: 'quran-intermediate',
          label: 'Menghafal Al-Quran',
          description: 'Teknik menghafal dan memahami makna',
          level: 'intermediate',
          position: { x: 400, y: 250 },
          resources: [
            {
              title: 'Metode Menghafal Al-Quran',
              type: 'video',
              description: 'Tutorial lengkap teknik menghafal Al-Quran yang efektif',
              url: 'https://example.com/tahfidz-method',
              subResources: [
                {
                  title: 'Metode Talaqqi',
                  type: 'video',
                  description: 'Penjelasan dan praktik metode talaqqi dalam menghafal',
                  url: 'https://example.com/talaqqi-method'
                },
                {
                  title: 'Teknik Visualisasi',
                  type: 'article',
                  description: 'Cara menggunakan visualisasi untuk memperkuat hafalan',
                  url: 'https://example.com/visualization-technique'
                },
                {
                  title: 'Metode Pengulangan',
                  type: 'video',
                  description: 'Strategi pengulangan efektif dalam menghafal',
                  url: 'https://example.com/repetition-method'
                }
              ]
            },
            {
              title: 'Memahami Arti Ayat',
              type: 'article',
              description: 'Panduan memahami makna ayat untuk memperkuat hafalan',
              url: 'https://example.com/understanding-verses',
              subResources: [
                {
                  title: 'Dasar Bahasa Arab Al-Quran',
                  type: 'video',
                  description: 'Pengenalan dasar bahasa Arab untuk memahami Al-Quran',
                  url: 'https://example.com/quranic-arabic'
                },
                {
                  title: 'Kosakata Al-Quran',
                  type: 'book',
                  description: 'Kumpulan kosakata yang sering muncul dalam Al-Quran',
                  url: 'https://example.com/quran-vocabulary'
                },
                {
                  title: 'Analisis Ayat',
                  type: 'article',
                  description: 'Cara menganalisis dan memahami struktur ayat',
                  url: 'https://example.com/verse-analysis'
                }
              ]
            }
          ]
        },
        {
          id: 'quran-advanced',
          label: 'Tafsir Al-Quran',
          description: 'Mempelajari tafsir dan ilmu-ilmu Al-Quran',
          level: 'advanced',
          position: { x: 750, y: 250 },
          resources: [
            {
              title: 'Metodologi Tafsir',
              type: 'article',
              description: 'Artikel mendalam tentang metodologi penafsiran Al-Quran',
              url: 'https://example.com/tafsir-methodology',
              subResources: [
                {
                  title: 'Tafsir bil Ma\'tsur',
                  type: 'video',
                  description: 'Penjelasan tentang metode tafsir dengan riwayat',
                  url: 'https://example.com/tafsir-bil-matsur'
                },
                {
                  title: 'Tafsir bil Ra\'yi',
                  type: 'article',
                  description: 'Pembahasan tentang metode tafsir dengan akal',
                  url: 'https://example.com/tafsir-bil-rayi'
                },
                {
                  title: 'Tafsir Maudhu\'i',
                  type: 'video',
                  description: 'Metode tafsir tematik dalam Al-Quran',
                  url: 'https://example.com/tafsir-maudhui'
                }
              ]
            },
            {
              title: 'Ulumul Quran',
              type: 'video',
              description: 'Seri pembelajaran ilmu-ilmu Al-Quran',
              url: 'https://example.com/ulumul-quran',
              subResources: [
                {
                  title: 'Asbabun Nuzul',
                  type: 'book',
                  description: 'Studi tentang sebab-sebab turunnya ayat',
                  url: 'https://example.com/asbabun-nuzul'
                },
                {
                  title: 'Nasikh Mansukh',
                  type: 'article',
                  description: 'Pembahasan tentang ayat-ayat yang menghapus dan dihapus',
                  url: 'https://example.com/nasikh-mansukh'
                },
                {
                  title: 'I\'jazul Quran',
                  type: 'video',
                  description: 'Kemukjizatan Al-Quran dari berbagai aspek',
                  url: 'https://example.com/ijazul-quran'
                }
              ]
            }
          ]
        }
      ],
      edges: [
        {
          source: 'quran-basic',
          target: 'quran-intermediate'
        },
        {
          source: 'quran-intermediate',
          target: 'quran-advanced'
        }
      ]
    },
    aqeedah: {
      nodes: [
        {
          id: 'aqeedah-basic',
          label: 'Dasar Aqidah',
          description: 'Memahami dasar-dasar keyakinan dalam Islam',
          level: 'basic',
          resources: [
            {
              title: 'Pengenalan Rukun Iman',
              type: 'video',
              description: 'Penjelasan tentang 6 rukun iman dalam Islam',
              url: 'https://example.com/rukun-iman',
              subResources: [
                {
                  title: 'Iman Kepada Allah',
                  type: 'article',
                  description: 'Memahami makna iman kepada Allah',
                  url: 'https://example.com/iman-allah'
                }
              ]
            }
          ]
        },
        {
          id: 'aqeedah-intermediate',
          label: 'Tauhid',
          description: 'Memperdalam pemahaman tentang keesaan Allah',
          level: 'intermediate',
          resources: [
            {
              title: 'Pembagian Tauhid',
              type: 'article',
              description: 'Memahami pembagian tauhid dalam Islam',
              url: 'https://example.com/pembagian-tauhid'
            }
          ]
        },
        {
          id: 'aqeedah-advanced',
          label: 'Studi Komparatif',
          description: 'Mempelajari perbandingan aqidah',
          level: 'advanced',
          resources: [
            {
              title: 'Perbandingan Mazhab Aqidah',
              type: 'book',
              description: 'Studi komparatif berbagai mazhab aqidah dalam Islam',
              url: 'https://example.com/comparative-aqeedah'
            }
          ]
        }
      ],
      edges: [
        {
          source: 'aqeedah-basic',
          target: 'aqeedah-intermediate'
        },
        {
          source: 'aqeedah-intermediate',
          target: 'aqeedah-advanced'
        }
      ]
    },
    fiqh: {
      nodes: [
        {
          id: 'fiqh-basic',
          label: 'Dasar Fiqih',
          description: 'Memahami dasar-dasar hukum Islam',
          level: 'basic',
          resources: [
            {
              title: 'Pengenalan Thaharah',
              type: 'video',
              description: 'Belajar tentang bersuci dalam Islam',
              url: 'https://example.com/thaharah',
              subResources: [
                {
                  title: 'Wudhu',
                  type: 'video',
                  description: 'Tata cara wudhu yang benar',
                  url: 'https://example.com/wudhu'
                },
                {
                  title: 'Tayammum',
                  type: 'article',
                  description: 'Panduan bersuci dengan debu',
                  url: 'https://example.com/tayammum'
                }
              ]
            }
          ]
        },
        {
          id: 'fiqh-intermediate',
          label: 'Fiqih Ibadah',
          description: 'Mempelajari hukum-hukum ibadah',
          level: 'intermediate',
          resources: [
            {
              title: 'Fiqih Shalat',
              type: 'video',
              description: 'Panduan lengkap tentang shalat',
              url: 'https://example.com/fiqh-shalat'
            }
          ]
        },
        {
          id: 'fiqh-advanced',
          label: 'Ushul Fiqih',
          description: 'Mempelajari metodologi hukum Islam',
          level: 'advanced',
          resources: [
            {
              title: 'Qawaid Fiqhiyyah',
              type: 'book',
              description: 'Kaidah-kaidah dalam fiqih Islam',
              url: 'https://example.com/qawaid-fiqh'
            }
          ]
        }
      ],
      edges: [
        {
          source: 'fiqh-basic',
          target: 'fiqh-intermediate'
        },
        {
          source: 'fiqh-intermediate',
          target: 'fiqh-advanced'
        }
      ]
    },
    hadith: {
      nodes: [
        {
          id: 'hadith-basic',
          label: 'Dasar Ilmu Hadits',
          description: 'Pengenalan ilmu hadits dan klasifikasinya',
          level: 'basic',
          resources: [
            {
              title: 'Pengenalan Ilmu Hadits',
              type: 'video',
              description: 'Dasar-dasar ilmu hadits dan sejarahnya',
              url: 'https://example.com/intro-hadith',
              subResources: [
                {
                  title: 'Definisi Hadits',
                  type: 'article',
                  description: 'Memahami pengertian dan komponen hadits',
                  url: 'https://example.com/hadith-definition'
                }
              ]
            }
          ]
        },
        {
          id: 'hadith-intermediate',
          label: 'Hadits Pilihan',
          description: 'Mempelajari hadits-hadits pilihan',
          level: 'intermediate',
          resources: [
            {
              title: 'Arba\'in An-Nawawi',
              type: 'book',
              description: '40 Hadits Pilihan Imam Nawawi',
              url: 'https://example.com/arbain-nawawi'
            }
          ]
        },
        {
          id: 'hadith-advanced',
          label: 'Ilmu Musthalah Hadits',
          description: 'Mempelajari terminologi hadits',
          level: 'advanced',
          resources: [
            {
              title: 'Musthalah Hadits',
              type: 'book',
              description: 'Terminologi dalam ilmu hadits',
              url: 'https://example.com/musthalah'
            }
          ]
        }
      ],
      edges: [
        {
          source: 'hadith-basic',
          target: 'hadith-intermediate'
        },
        {
          source: 'hadith-intermediate',
          target: 'hadith-advanced'
        }
      ]
    },
    seerah: {
      nodes: [
        {
          id: 'seerah-basic',
          label: 'Dasar Sirah',
          description: 'Pengenalan sejarah hidup Nabi Muhammad ﷺ',
          level: 'basic',
          resources: [
            {
              title: 'Masa Kecil Rasulullah',
              type: 'video',
              description: 'Mempelajari masa kecil dan remaja Nabi Muhammad ﷺ',
              url: 'https://example.com/early-life',
              subResources: [
                {
                  title: 'Kelahiran Nabi',
                  type: 'article',
                  description: 'Kisah kelahiran Nabi Muhammad ﷺ',
                  url: 'https://example.com/prophet-birth'
                }
              ]
            }
          ]
        },
        {
          id: 'seerah-intermediate',
          label: 'Periode Makkah & Madinah',
          description: 'Mempelajari dakwah di Makkah dan Madinah',
          level: 'intermediate',
          resources: [
            {
              title: 'Dakwah di Makkah',
              type: 'video',
              description: 'Periode dakwah di Makkah',
              url: 'https://example.com/makkan-period'
            }
          ]
        },
        {
          id: 'seerah-advanced',
          label: 'Analisis Sirah',
          description: 'Analisis mendalam tentang sirah',
          level: 'advanced',
          resources: [
            {
              title: 'Fiqih Sirah',
              type: 'book',
              description: 'Pelajaran hukum dari sirah Nabi',
              url: 'https://example.com/fiqh-seerah'
            }
          ]
        }
      ],
      edges: [
        {
          source: 'seerah-basic',
          target: 'seerah-intermediate'
        },
        {
          source: 'seerah-intermediate',
          target: 'seerah-advanced'
        }
      ]
    },
    arabic: {
      nodes: [
        {
          id: 'arabic-basic',
          label: 'Dasar Bahasa Arab',
          description: 'Mempelajari dasar-dasar bahasa Arab',
          level: 'basic',
          resources: [
            {
              title: 'Huruf Arab',
              type: 'video',
              description: 'Belajar menulis dan membaca huruf Arab',
              url: 'https://example.com/arabic-letters',
              subResources: [
                {
                  title: 'Penulisan Huruf',
                  type: 'video',
                  description: 'Cara menulis huruf Arab dengan benar',
                  url: 'https://example.com/writing-arabic'
                }
              ]
            }
          ]
        },
        {
          id: 'arabic-intermediate',
          label: 'Nahwu & Sharaf',
          description: 'Mempelajari tata bahasa Arab',
          level: 'intermediate',
          resources: [
            {
              title: 'Dasar Nahwu',
              type: 'video',
              description: 'Pengenalan ilmu nahwu',
              url: 'https://example.com/nahwu'
            }
          ]
        },
        {
          id: 'arabic-advanced',
          label: 'Balaghah',
          description: 'Mempelajari sastra Arab',
          level: 'advanced',
          resources: [
            {
              title: 'Ilmu Balaghah',
              type: 'book',
              description: 'Dasar-dasar ilmu balaghah',
              url: 'https://example.com/balaghah'
            }
          ]
        }
      ],
      edges: [
        {
          source: 'arabic-basic',
          target: 'arabic-intermediate'
        },
        {
          source: 'arabic-intermediate',
          target: 'arabic-advanced'
        }
      ]
    }
  };

  // TOPIC
  const topics = {
    quran: {
      id: 'quran',
      title: 'Al-Quran',
      description: 'Kumpulan sumber belajar Al-Quran dan ilmu-ilmu terkait.',
      resources: [
        {
          title: "Mudah Belajar Tajwid",
          author: "Dr. Syed Kalimullah Qadri",
          description: "Panduan lengkap belajar Tajwid dengan contoh praktis.",
          level: "Pemula",
          language: "Indonesia",
          downloadUrl: "https://waqfeya.net/book.php?bid=2538"
        }
      ],
      additionalResources: [
        {
          title: "Pengantar Ilmu Tajwid",
          author: "Ustadz Nouman Ali Khan",
          type: "video",
          description: "Seri video pembelajaran dasar-dasar Tajwid",
          language: "Indonesia",
          url: "https://www.youtube.com/watch?v=example1",
          platform: "YouTube"
        }
      ]
    },
    aqeedah: {
      id: 'aqeedah',
      title: 'Aqidah',
      description: 'Mempelajari dasar-dasar keyakinan dalam Islam.',
      resources: [
        {
          title: "Kitab Tauhid",
          author: "Syaikh Muhammad bin Abdul Wahhab",
          description: "Penjelasan mendasar tentang tauhid dalam Islam",
          level: "Pemula",
          language: "Indonesia",
          downloadUrl: "https://example.com/kitab-tauhid"
        }
      ],
      additionalResources: [
        {
          title: "Pengantar Ilmu Tauhid",
          author: "Ustadz Abdul Somad",
          type: "video",
          description: "Seri video pembelajaran dasar-dasar tauhid",
          language: "Indonesia",
          url: "https://example.com/tauhid-intro",
          platform: "YouTube"
        }
      ]
    },
    fiqh: {
      id: 'fiqh',
      title: 'Fiqih',
      description: 'Mempelajari hukum-hukum Islam dalam kehidupan sehari-hari.',
      resources: [
        {
          title: "Fiqih Praktis",
          author: "Dr. Yusuf Al-Qaradawi",
          description: "Panduan praktis fiqih sehari-hari",
          level: "Pemula",
          language: "Indonesia",
          downloadUrl: "https://example.com/fiqh-praktis"
        }
      ],
      additionalResources: [
        {
          title: "Belajar Fiqih Ibadah",
          author: "Ustadz Adi Hidayat",
          type: "video",
          description: "Seri pembelajaran fiqih ibadah sehari-hari",
          language: "Indonesia",
          url: "https://example.com/fiqh-ibadah",
          platform: "YouTube"
        }
      ]
    },
    hadith: {
      id: 'hadith',
      title: 'Hadits',
      description: 'Mempelajari hadits dan ilmu-ilmu hadits.',
      resources: [
        {
          title: "Riyadhus Shalihin",
          author: "Imam An-Nawawi",
          description: "Kumpulan hadits pilihan tentang akhlak",
          level: "Pemula",
          language: "Indonesia",
          downloadUrl: "https://example.com/riyadhus-shalihin"
        }
      ],
      additionalResources: [
        {
          title: "Pengantar Ilmu Hadits",
          author: "Ustadz Felix Siauw",
          type: "video",
          description: "Dasar-dasar ilmu hadits",
          language: "Indonesia",
          url: "https://example.com/hadith-intro",
          platform: "YouTube"
        }
      ]
    },
    seerah: {
      id: 'seerah',
      title: 'Sirah',
      description: 'Mempelajari sejarah kehidupan Nabi Muhammad ﷺ.',
      resources: [
        {
          title: "Sirah Nabawiyah",
          author: "Syaikh Shafiyyurrahman Al-Mubarakfuri",
          description: "Sejarah lengkap kehidupan Nabi Muhammad ﷺ",
          level: "Pemula",
          language: "Indonesia",
          downloadUrl: "https://example.com/sirah-nabawiyah"
        }
      ],
      additionalResources: [
        {
          title: "Kisah Nabi Muhammad ﷺ",
          author: "Ustadz Khalid Basalamah",
          type: "video",
          description: "Seri video tentang kehidupan Nabi Muhammad ﷺ",
          language: "Indonesia",
          url: "https://example.com/prophet-story",
          platform: "YouTube"
        }
      ]
    },
    arabic: {
      id: 'arabic',
      title: 'Bahasa Arab',
      description: 'Mempelajari bahasa Arab untuk memahami Al-Quran dan Hadits.',
      resources: [
        {
          title: "Durusul Lughah",
          author: "Dr. V. Abdur Rahim",
          description: "Buku pembelajaran bahasa Arab modern",
          level: "Pemula",
          language: "Indonesia",
          downloadUrl: "https://example.com/durusul-lughah"
        }
      ],
      additionalResources: [
        {
          title: "Belajar Bahasa Arab",
          author: "Ustadz Erwandi Tarmizi",
          type: "video",
          description: "Seri pembelajaran bahasa Arab untuk pemula",
          language: "Indonesia",
          url: "https://example.com/learn-arabic",
          platform: "YouTube"
        }
      ]
    }
  };

  return Object.keys(topics).map((topic) => {
  return {
    params: { topic },
    props: { 
      topicData: topics[topic as keyof typeof topics], 
      roadmapData: topicRoadmaps[topic as keyof typeof topicRoadmaps]
    }
  };
});

const { topic } = Astro.params;
const { topicData, roadmapData } = Astro.props;

const allResources = [
  ...topicData.resources.map((r: { [key: string]: any }) => ({ ...r, type: 'Buku' })),
  ...(topicData.additionalResources || []).map((r: { type?: string }) => ({ ...r, type: r.type === 'video' ? 'Video' : 'Artikel' }))
];
---

<Layout title={`${topicData.title} - Peta Islam`}>
  <main class="container mx-auto px-4 py-8">
    <div class="max-w-4xl mx-auto">
      <h1 class="text-4xl font-bold text-primary mb-4">{topicData.title}</h1>
      <p class="text-xl text-gray-600 mb-8">{topicData.description}</p>

      <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
        <h2 class="text-2xl font-bold text-primary mb-4">Alur Pembelajaran {topicData.title}</h2>
        <p class="text-gray-600 mb-6">Klik pada setiap tahap untuk melihat sumber pembelajaran yang tersedia.</p>
        <LearningRoadmap client:load nodes={roadmapData.nodes} edges={roadmapData.edges} />
      </div>

      <SearchAndFilter client:load resources={allResources} />

      <div class="space-y-8">
        <ResourceLibrary books={topicData.resources} />
        
        {topicData.additionalResources && (
          <AdditionalResources resources={topicData.additionalResources} />
        )}
      </div>

      <div class="mt-8">
        <a
          href="/"
          class="inline-flex items-center text-accent hover:text-primary transition-colors"
        >
          <span class="mr-2">←</span>
          Kembali ke Topik
        </a>
      </div>
    </div>
  </main>
</Layout>